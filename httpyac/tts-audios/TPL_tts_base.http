# -------------------------------------------------------------
# Template de Requisição: Gerar Áudio (Text-to-Speech)
# -------------------------------------------------------------

{{
    $context.variables.requestStartTime = Date.now();

    exports.loopControl = {
        model_index: 0,
    };
}}

# @loop while loopControl.model_index < models.length
# @name generateAudio
# @no-log
POST {{baseURL}}/v1/text-to-speech/{{VOICE_ID}}
xi-api-key: {{ELEVEN_API_KEY}}
Content-Type: application/json
Accept: audio/mpeg

{
    "text": "{{ input }}",
    "model_id": "{{ models[loopControl.model_index] }}",
    "voice_settings": {
        "stability": {{stability}},
        "similarity_boost": {{similarity_boost}},
        "speed": {{speed}},
        "style": {{style}}
    }
}

{{
    const { saveAudioResponse } = require('../../common/PostRequest.js');
    try {
        await saveAudioResponse({ response, context: $context });
    } catch (error) {
        console.error('[HTTPYac] Erro no script pós-requisição:', error);
    } finally {
        loopControl.model_index++;
    }
}}
###